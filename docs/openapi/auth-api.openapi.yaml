openapi: 3.0.3
info:
  title: Aftourism 基础认证接口
  version: '1.0.0'
  description: |
    前后台分离的统一认证接口，所有接口基于 JWT（HS256）实现无状态认证。
    登录成功后需要在 `Authorization` 头中携带 `Bearer {token}`。
servers:
  - url: http://localhost:8080
    description: 本地开发环境
paths:
  /portal/auth/register:
    post:
      summary: 门户用户注册
      description: |-
        使用用户名与密码注册新的门户用户，密码以 BCrypt 加密保存于 `t_user` 表。
        其他资料（昵称、联系方式等）将同步落库，字段定义参考 `docs/main.sql`。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '200':
          description: 注册成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResultVoid'
  /portal/auth/login:
    post:
      summary: 门户用户登录
      description: |-
        登录成功返回携带主体信息与 JWT 的统一响应。
        仅 `status=1` 且 `is_deleted=0` 的门户用户可以成功登录。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResultLoginResponse'
  /admin/auth/login:
    post:
      summary: 管理员登录
      description: |-
        管理员基于 `t_admin` 表进行身份校验，返回 `principalType=ADMIN` 的 JWT。
        仅启用状态的管理员账号可以登录后台接口。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResultLoginResponse'
        '401':
          description: 登录失败或凭证错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ResultString'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    ResultVoid:
      type: object
      description: 统一返回结构（无数据体）
      properties:
        code:
          type: integer
          format: int32
          description: 结果码，1 表示成功
        msg:
          type: string
          description: 提示信息
        data:
          nullable: true
          description: 数据体为空
    ResultLoginResponse:
      type: object
      description: 登录成功时返回的统一结构
      properties:
        code:
          type: integer
        msg:
          type: string
        data:
          $ref: '#/components/schemas/LoginResponse'
    ResultString:
      type: object
      description: 错误返回结构
      properties:
        code:
          type: integer
        msg:
          type: string
        data:
          type: string
          nullable: true
    RegisterRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          maxLength: 50
          description: 登录账号（唯一）
        password:
          type: string
          minLength: 6
          maxLength: 100
          description: 登录密码
        nickname:
          type: string
          maxLength: 50
          description: 昵称/姓名，缺省时后台将使用用户名
        phone:
          type: string
          maxLength: 20
          description: 联系电话
        email:
          type: string
          format: email
          maxLength: 100
          description: 邮箱
        avatar:
          type: string
          maxLength: 255
          description: 头像地址
        remark:
          type: string
          maxLength: 255
          description: 备注
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          description: 用户名
        password:
          type: string
          description: 用户密码
    LoginResponse:
      type: object
      properties:
        principalId:
          type: integer
          format: int64
          description: 主体 ID，对应 t_user.id 或 t_admin.id
        principalType:
          type: string
          enum: [PORTAL_USER, ADMIN]
          description: 主体类型
        userId:
          type: integer
          format: int64
          nullable: true
          description: 兼容字段，门户用户返回与 principalId 相同的值
        username:
          type: string
          description: 登录账号
        nickname:
          type: string
          nullable: true
          description: 显示名称（门户为昵称，后台为真实姓名）
        avatar:
          type: string
          nullable: true
          description: 头像地址（仅门户用户返回）
        phone:
          type: string
          nullable: true
          description: 联系电话
        email:
          type: string
          format: email
          nullable: true
          description: 邮箱
        status:
          type: integer
          format: int32
          description: 账号状态（1启用 0禁用）
        token:
          type: string
          description: 登录后签发的 JWT
        expiresAt:
          type: string
          format: date-time
          description: Token 过期时间（ISO-8601 格式）
security:
  - bearerAuth: []
