<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="aftnos.aftourismserver.admin.mapper.VenueMapper">

    <resultMap id="VenueResultMap" type="aftnos.aftourismserver.admin.pojo.Venue">
        <id property="id" column="id" />
        <result property="name" column="name" />
        <result property="imageUrl" column="image_url" />
        <result property="category" column="category" />
        <result property="isFree" column="is_free" />
        <result property="ticketPrice" column="ticket_price" />
        <result property="address" column="address" />
        <result property="openTime" column="open_time" />
        <result property="description" column="description" />
        <result property="phone" column="phone" />
        <result property="website" column="website" />
        <result property="longitude" column="longitude" />
        <result property="latitude" column="latitude" />
        <result property="sort" column="sort" />
        <result property="isDeleted" column="is_deleted" />
        <result property="createTime" column="create_time" />
        <result property="updateTime" column="update_time" />
    </resultMap>

    <sql id="Base_Column_List">
        id, name, image_url, category, is_free, ticket_price, address, open_time, description, phone, website,
        longitude, latitude, sort, is_deleted, create_time, update_time
    </sql>

    <insert id="insert" parameterType="aftnos.aftourismserver.admin.pojo.Venue" useGeneratedKeys="true"
            keyProperty="id">
        INSERT INTO t_venue
        (name, image_url, category, is_free, ticket_price, address, open_time, description, phone, website,
         longitude, latitude, sort, is_deleted, create_time, update_time)
        VALUES
        (#{name}, #{imageUrl}, #{category}, #{isFree}, #{ticketPrice}, #{address}, #{openTime}, #{description},
         #{phone}, #{website}, #{longitude}, #{latitude}, #{sort}, #{isDeleted}, #{createTime}, #{updateTime})
    </insert>

    <update id="update" parameterType="aftnos.aftourismserver.admin.pojo.Venue">
        UPDATE t_venue
        <set>
            <if test="name != null">name = #{name},</if>
            <if test="imageUrl != null">image_url = #{imageUrl},</if>
            <if test="category != null">category = #{category},</if>
            <if test="isFree != null">is_free = #{isFree},</if>
            <if test="ticketPrice != null">ticket_price = #{ticketPrice},</if>
            <if test="address != null">address = #{address},</if>
            <if test="openTime != null">open_time = #{openTime},</if>
            <if test="description != null">description = #{description},</if>
            <if test="phone != null">phone = #{phone},</if>
            <if test="website != null">website = #{website},</if>
            <if test="longitude != null">longitude = #{longitude},</if>
            <if test="latitude != null">latitude = #{latitude},</if>
            <if test="sort != null">sort = #{sort},</if>
            update_time = #{updateTime}
        </set>
        WHERE id = #{id} AND is_deleted = 0
    </update>

    <select id="selectById" resultMap="VenueResultMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM t_venue
        WHERE id = #{id} AND is_deleted = 0
    </select>

    <update id="logicalDelete">
        UPDATE t_venue
        SET is_deleted = 1,
            update_time = #{updateTime}
        WHERE id = #{id} AND is_deleted = 0
    </update>

    <select id="pageList" parameterType="aftnos.aftourismserver.admin.dto.VenuePageQuery"
            resultType="aftnos.aftourismserver.admin.vo.VenueVO">
        SELECT
        id,
        name,
        image_url AS imageUrl,
        category,
        is_free AS isFree,
        ticket_price AS ticketPrice,
        address,
        open_time AS openTime,
        description,
        phone,
        website,
        longitude,
        latitude,
        sort,
        create_time AS createTime,
        update_time AS updateTime
        FROM t_venue
        <where>
            is_deleted = 0
            <if test="name != null and name != ''">
                AND name LIKE CONCAT('%', #{name}, '%')
            </if>
            <if test="category != null and category != ''">
                AND category LIKE CONCAT('%', #{category}, '%')
            </if>
            <if test="address != null and address != ''">
                AND address LIKE CONCAT('%', #{address}, '%')
            </if>
            <if test="isFree != null">
                AND is_free = #{isFree}
            </if>
        </where>
        ORDER BY sort DESC, update_time DESC
    </select>

    <select id="selectDetail" resultType="aftnos.aftourismserver.admin.vo.VenueVO">
        SELECT
        id,
        name,
        image_url AS imageUrl,
        category,
        is_free AS isFree,
        ticket_price AS ticketPrice,
        address,
        open_time AS openTime,
        description,
        phone,
        website,
        longitude,
        latitude,
        sort,
        create_time AS createTime,
        update_time AS updateTime
        FROM t_venue
        WHERE id = #{id} AND is_deleted = 0
    </select>

    <select id="portalPageList" parameterType="aftnos.aftourismserver.portal.dto.VenuePortalPageQuery"
            resultType="aftnos.aftourismserver.portal.vo.VenueSummaryVO">
        SELECT
        id,
        name,
        image_url AS imageUrl,
        category,
        is_free AS isFree,
        ticket_price AS ticketPrice,
        address,
        open_time AS openTime,
        sort
        FROM t_venue
        <where>
            is_deleted = 0
            <if test="name != null and name != ''">
                AND name LIKE CONCAT('%', #{name}, '%')
            </if>
            <if test="category != null and category != ''">
                AND category LIKE CONCAT('%', #{category}, '%')
            </if>
            <if test="address != null and address != ''">
                AND address LIKE CONCAT('%', #{address}, '%')
            </if>
            <if test="isFree != null">
                AND is_free = #{isFree}
            </if>
        </where>
        ORDER BY sort DESC, update_time DESC
    </select>

    <select id="portalDetail" resultType="aftnos.aftourismserver.portal.vo.VenueDetailVO">
        SELECT
            id,
            name,
            image_url AS imageUrl,
            category,
            is_free AS isFree,
            ticket_price AS ticketPrice,
            address,
            open_time AS openTime,
            description,
            phone,
            website,
            longitude,
            latitude,
            sort,
            create_time AS createTime,
            update_time AS updateTime
        FROM t_venue
        WHERE id = #{id} AND is_deleted = 0
    </select>

    <select id="selectByIds" resultMap="VenueResultMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM t_venue
        WHERE is_deleted = 0
          AND id IN
          <foreach collection="ids" item="id" open="(" separator="," close=")">
              #{id}
          </foreach>
    </select>

</mapper>
